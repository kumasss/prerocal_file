<?php
require_once (dirname(__FILE__).'/common/users.php'); define('AUTH_RES_PASS',0); define('AUTH_RES_EXCEPTION', 99); define('AUTH_RES_MAIL', 999); function jdgAuth($userid, $pass, &$data) { $ret = AUTH_RES_EXCEPTION; $usersObj = new users(); $usersObj->check_mailadd($userid); $err = $usersObj->get_err(); $id = $usersObj->get_user_id($userid); if(!empty($err) || empty($id)){ return AUTH_RES_MAIL; } $usersObj->db_login( $userid, $pass, $auth=USER_ROLL, $user ); if(!empty($user)) { if(!empty($user['send_date'])) { $data['reg_date'] = date('Y/m/d', strtotime( $user['send_date'] )); } else { $data['reg_date'] = date('Y/m/d', strtotime( "+1 day" )); } if(!empty($user['group_id'])) $data['group_id']=$user['group_id']; $ret = AUTH_RES_PASS; } else if( $usersObj->db_is_admin($id) == 1 ) { if( $result = $usersObj->db_login( $userid, $pass, $auth=ADMIN_ROLL, $admin)) { $reg_date = date('Y/m/d', strtotime( $admin['created'] )); $ret = AUTH_RES_PASS; } } return $ret; } function isAuthAlive(){ $ret = false; if(isset($_SESSION[SESSION_USER_ID]) && isset($_SESSION[SESSION_PASSWORD])) { if(jdgAuth($_SESSION[SESSION_USER_ID], $_SESSION[SESSION_PASSWORD], $dummy) == AUTH_RES_PASS) { $ret = true; } } return $ret; } 