<?php
require_once( dirname(__FILE__).'/main.php' ); class payment_lib extends main { function find_payment_id_by_bank_order( $order_id ) { $stmt = $this->pdo->prepare('SELECT status,user_id FROM pm_contract WHERE bank_txn_id=:bank_txn_id'); $stmt->bindValue(":bank_txn_id", $order_id, PDO::PARAM_STR); $stmt->execute(); return $stmt->fetchAll(PDO::FETCH_OBJ); } function find_payment_id_by_paypal_order( $order_id ) { $stmt = $this->pdo->prepare('SELECT status,user_id FROM pm_contract WHERE txn_id=:txn_id'); $stmt->bindValue(":txn_id", $order_id, PDO::PARAM_STR); $stmt->execute(); return $stmt->fetchAll(PDO::FETCH_OBJ); } function count_users_by_id( $user_id ) { $stmt = $this->pdo->prepare('SELECT count(*) as cnt FROM users WHERE id=:user_id'); $stmt->bindValue(":user_id", $user_id, PDO::PARAM_INT); $stmt->execute(); return $stmt->fetchAll(PDO::FETCH_OBJ); } function count_product_in_group( $group_id ) { $cnt = 0; $result = 0; $obj_arr = $this->db_count_product_in_group( $group_id ); foreach($obj_arr as $obj){ $group_arr = json_decode($obj->group_info, true); if (is_array($group_arr)){ foreach($group_arr as $group){ foreach($group as $id=>$val){ if ( $val != 0) { if( $id == $group_id) $cnt++; } } } } } if($cnt > 0 ) { $result = $cnt; } return $result; } private function db_count_product_in_group( $group_id ) { try { $sql = "SELECT group_info
					FROM `pm_product` "; $stmt = $this->pdo->prepare( $sql ); $stmt->bindValue( ':group_id', $group_id, PDO::PARAM_INT ); $stmt->execute(); return $stmt->fetchAll(PDO::FETCH_OBJ); } catch(PDOException $e){ die($e->getMessage()); } } }